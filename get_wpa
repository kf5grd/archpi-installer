#!/bin/sh
WPA_FILE="/boot/wpa_supplicant.conf"
WLAN0_FILE="/boot/wlan0.network"
WLAN0_DEST="/etc/systemd/network/wlan0.network"

copy_wpa_config() {
    mv "$WPA_FILE" /etc/wpa_supplicant/wpa_supplicant-wlan0.conf
}

copy_wlan_config() {
    mv "$WLAN0_FILE" "$WLAN0_DEST"
}

write_default_wlan_config() {
        cat << EOF > "$WLAN0_DEST"
[Match]
Name=wlan0

[Network]
DHCP=yes
EOF
}

enable_networking() {
    if [ -f "$WPA_FILE" ]; then
	copy_wpa_config
    fi

    if [ -f "$WLAN0_FILE" ] && [ ! -f "$WLAN0_DEST" ]; then
	copy_wlan_config
    else
	write_default_wlan_config
    fi

    systemctl enable --now wpa_supplicant@wlan0.service
}

enable_networking
